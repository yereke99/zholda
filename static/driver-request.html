<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É | ”®—Ç—ñ–Ω—ñ–º –∂–∞—Å–∞—É</title>
  <link rel="stylesheet" href="/static/driver-request/style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://api-maps.yandex.ru/v3/?apikey=8a3e4da0-9ef2-4176-9203-e7014c1dba6f&lang=ru_RU"></script>
</head>
<body>
  <!-- Permission Dialog -->
  <div id="permissionDialog" class="permission-dialog" style="display: none;">
    <div class="permission-content">
      <div class="permission-icon">üìç</div>
      <div class="permission-title" data-ru="–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é" data-kz="–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è“ì–∞ —Ä“±“õ—Å–∞—Ç">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</div>
      <div class="permission-message" data-ru="–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ—á–Ω–æ–π –∑–∞—è–≤–∫–∏ –Ω–∞–º –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–∞–π—Ç–∏ –≤–∞—Å –±—ã—Å—Ç—Ä–µ–µ." data-kz="–î”ô–ª ”©—Ç—ñ–Ω—ñ–º –∂–∞—Å–∞—É “Ø—à—ñ–Ω –±—ñ–∑–≥–µ —Å—ñ–∑–¥—ñ“£ –æ—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä—ñ“£—ñ–∑–≥–µ “õ–æ–ª –∂–µ—Ç–∫—ñ–∑—É –∫–µ—Ä–µ–∫. –ë“±–ª –∫–ª–∏–µ–Ω—Ç—Ç–µ—Ä–≥–µ —Å—ñ–∑–¥—ñ —Ç–µ–∑—ñ—Ä–µ–∫ —Ç–∞–±—É“ì–∞ –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ.">
        –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ—á–Ω–æ–π –∑–∞—è–≤–∫–∏ –Ω–∞–º –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–∞–π—Ç–∏ –≤–∞—Å –±—ã—Å—Ç—Ä–µ–µ.
      </div>
      <div class="permission-buttons">
        <button class="permission-btn primary" onclick="requestLocationPermission()">
          <span data-ru="–†–∞–∑—Ä–µ—à–∏—Ç—å GPS" data-kz="GPS —Ä“±“õ—Å–∞—Ç –±–µ—Ä—É">–†–∞–∑—Ä–µ—à–∏—Ç—å GPS</span>
        </button>
        <button class="permission-btn secondary" onclick="skipLocationPermission()">
          <span data-ru="–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" data-kz="”®—Ç–∫—ñ–∑—ñ–ø –∂—ñ–±–µ—Ä—É">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</span>
        </button>
      </div>
    </div>
  </div>

  <div class="main-container">
    <div class="lang-switch">
      <button onclick="setLang('ru')" id="lang-ru" class="active">RU</button>
      <button onclick="setLang('kz')" id="lang-kz">KZ</button>
    </div>

    <div class="content-wrapper">
      <!-- Step 1: Create Request -->
      <div id="step1" class="page active">
        <div class="form-progress"></div>
        <h1 data-ru="–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É" data-kz="”®—Ç—ñ–Ω—ñ–º –∂–∞—Å–∞—É">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</h1>
        
        <div id="mapContainer">
          <div id="driverRequestMap"></div>
          <div class="route-info" id="routeInfo" style="display: none;">
            <span id="routeDistance"></span>
          </div>
          <div class="location-status" id="locationStatus" style="display: none;">
            <div class="pulse"></div>
            <span id="locationText"></span>
          </div>
          <div class="map-controls">
            <button class="map-control-btn toggle-size-btn" onclick="toggleMapSize()" title="–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã">
              <span class="size-text">üìç –ë–û–õ–¨–®–ê–Ø</span>
            </button>
          </div>
        </div>
        
        <div class="form-container">
          <form id="driverRequestForm">
            <!-- FROM Address with Enhanced Map Button -->
            <div class="form-group">
              <label for="from_address">
                <span class="emoji">üìç</span>
                <span data-ru="–û—Ç–∫—É–¥–∞" data-kz="“ö–∞–π–¥–∞–Ω">–û—Ç–∫—É–¥–∞</span>
              </label>
              <div class="address-input-container">
                <input type="text" id="from_address" name="from_address" class="address-input" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ" required>
                <button type="button" class="address-map-btn from-btn from-map-btn" onclick="selectOnMap('from')">
                  üó∫Ô∏è –ö–ê–†–¢–ê
                </button>
              </div>
              <div id="from_address_suggestions" class="suggestions-container" style="display: none;"></div>
            </div>
            
            <!-- TO Address with Enhanced Map Button -->
            <div class="form-group">
              <label for="to_address">
                <span class="emoji">üéØ</span>
                <span data-ru="–ö—É–¥–∞" data-kz="“ö–∞–π–¥–∞">–ö—É–¥–∞</span>
              </label>
              <div class="address-input-container">
                <input type="text" id="to_address" name="to_address" class="address-input" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ" required>
                <button type="button" class="address-map-btn to-btn to-map-btn" onclick="selectOnMap('to')">
                  üó∫Ô∏è –ö–ê–†–¢–ê
                </button>
              </div>
              <div id="to_address_suggestions" class="suggestions-container" style="display: none;"></div>
            </div>
            
            <!-- Price Input -->
            <div class="form-group">
              <label for="price">
                <span class="emoji">üí∞</span>
                <span data-ru="–¶–µ–Ω–∞" data-kz="–ë–∞“ì–∞—Å—ã">–¶–µ–Ω–∞</span>
              </label>
              <div class="price-input">
                <input type="number" id="price" name="price" min="2000" placeholder="–ú–∏–Ω–∏–º—É–º 2000" required>
                <span class="price-currency">‚Ç∏</span>
              </div>
            </div>
            
            <!-- Comment -->
            <div class="form-group">
              <label for="comment">
                <span class="emoji">üí¨</span>
                <span data-ru="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" data-kz="–¢“Ø—Å—ñ–Ω—ñ–∫—Ç–µ–º–µ">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span>
              </label>
              <textarea id="comment" name="comment" 
                        placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–∑–µ –∏–ª–∏ –æ—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è"></textarea>
            </div>
            
            <!-- Departure Time -->
            <div class="form-group">
              <label for="departure_time">
                <span class="emoji">üïê</span>
                <span data-ru="–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è" data-kz="–ñ”©–Ω–µ–ª—É —É–∞“õ—ã—Ç—ã">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
              </label>
              <input type="datetime-local" id="departure_time" name="departure_time" required>
            </div>
            
            <!-- Hidden coordinate fields -->
            <input type="hidden" name="from_lat" id="from_lat">
            <input type="hidden" name="from_lon" id="from_lon">
            <input type="hidden" name="to_lat" id="to_lat">
            <input type="hidden" name="to_lon" id="to_lon">
            <input type="hidden" name="telegram_id" id="telegram_id">
          </form>
        </div>
      </div>

      <!-- Step 2: Preview -->
      <div id="step2" class="page">
        <div class="form-progress"></div>
        <h1 data-ru="–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ" data-kz="–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ</h1>
        <div id="previewContent"></div>
      </div>

      <!-- Step 3: Success & Client Requests -->
      <div id="step3" class="page">
        <div class="success-page">
          <div class="success-icon">‚úÖ</div>
          <h1 data-ru="–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!" data-kz="”®—Ç—ñ–Ω—ñ–º –∂–∞—Å–∞–ª–¥—ã!">–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</h1>
          <p class="success-subtitle" data-ru="–ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤" data-kz="“ö–æ–ª–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç—Ç–µ—Ä–¥—ñ —ñ–∑–¥–µ—É–¥–µ">–ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
        </div>
        
        <h2 style="text-align: center; margin: 30px 0;" data-ru="–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞—è–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤" data-kz="“ö–æ–ª –∂–µ—Ç—ñ–º–¥—ñ –∫–ª–∏–µ–Ω—Ç ”©—Ç—ñ–Ω—ñ–º–¥–µ—Ä—ñ">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞—è–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
        
        <div id="clientRequests" class="requests-container">
          <!-- Client requests will be loaded here -->
        </div>
        
        <div class="button-group" style="margin-top: 30px;">
          <button class="btn btn-secondary" onclick="Telegram.WebApp.close()">
            <span>‚ùå</span>
            <span data-ru="–ó–∞–∫—Ä—ã—Ç—å" data-kz="–ñ–∞–±—É">–ó–∞–∫—Ä—ã—Ç—å</span>
          </button>
        </div>
      </div>
    </div>

    <div class="fixed-bottom-buttons" id="fixedButtons">
      <div class="button-group">
        <button type="button" id="backBtn" class="nav-btn" style="display: none;">‚Üê <span data-ru="–ù–∞–∑–∞–¥" data-kz="–ê—Ä—Ç“õ–∞">–ù–∞–∑–∞–¥</span></button>
      </div>
    </div>
  </div>

  <!-- Client Request Detail Modal -->
  <div id="requestModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-ru="–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏" data-kz="”®—Ç—ñ–Ω—ñ–º –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä—ñ">–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏</h2>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      
      <div id="modalContent">
        <!-- Content will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Service scripts in correct order -->
  <script src="/static/driver-request/locationService.js"></script>
  <script src="/static/driver-request/mapService.js"></script>
  <script src="/static/driver-request/formService.js"></script>
  <script src="/static/driver-request/clientService.js"></script>
  <script src="/static/driver-request/appService.js"></script>
</body>
</html>
